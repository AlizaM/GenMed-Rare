model:
  pretrained_model: "danyalmalik/stable-diffusion-chest-xray"
  vae:
    path: "stabilityai/sd-vae-ft-mse"
  use_lora: true  # Use LoRA for efficient fine-tuning
  lora_rank: 64
  lora_alpha: 32
  lora_target_modules: ["to_k", "to_q", "to_v", "to_out.0"]
  lora_dropout: 0.1
  lora_bias: "none"
  
training:
  # Prior-based training for Pneumonia - TEST CONFIG
  mode: "prior_based"
  target_pathology: "pneumonia"
  
  # Data paths
  target_images_dir: "data/pure_class_folders/pneumonia"
  target_images_csv: "data/pure_class_folders/pneumonia_images.csv"
  prior_images_dir: "data/pure_class_folders/healthy"
  prior_images_csv: "data/pure_class_folders/healthy_images.csv"
  
  # Conditioning prompts
  target_prompt: "a chest x-ray with pneumonia"
  prior_prompt: "a chest x-ray"
  
  # Training parameters - SHORTENED FOR TESTING
    repeats_per_target: 12
    num_train_epochs: 1
    train_batch_size: 4
    learning_rate: 0.00001
    gradient_accumulation_steps: 1
    max_train_steps: 4
    use_tensorboard: true
  
  # Image settings
  resolution: 512
  center_crop: true
  random_flip: false
  
  # Validation and checkpointing
  checkpoint_dir: "outputs/diffusion_pneumonia_test/checkpoints"
  log_dir: "outputs/diffusion_pneumonia_test/logs"
    save_steps: 2
    validation_steps: 4
  num_validation_images: 2
  validation_prompt: "a chest x-ray with pneumonia"
  
  # Mixed precision and optimization
  mixed_precision: "fp16"
  enable_xformers_memory_efficient_attention: true
  gradient_checkpointing: true
  dataloader_num_workers: 2
  pin_memory: false
  
  # Noise scheduler
  noise_scheduler: "ddpm"
  beta_start: 0.00085
  beta_end: 0.012
  beta_schedule: "scaled_linear"
  num_train_timesteps: 1000

generation:
  num_inference_steps: 20  # Fewer steps for faster testing
  guidance_scale: 7.5

hardware:
  enable_attention_slicing: true
  enable_vae_slicing: true
  
paths:
  output_dir: "outputs/diffusion_pneumonia_test"
  logging_dir: "outputs/diffusion_pneumonia_test/logs"
  
experiment:
  name: "pneumonia_test"
  tags: ["pneumonia", "test", "medical", "lora"]
  seed: 100
  
logging:
  report_to: "tensorboard"
  log_level: "INFO" 
